# React のコンポーネントをどのように設計するべきか in Redwood
## このドキュメントの目的
React のコンポーネント設計についての方針をまとめることで、開発者間での共通認識を持つことを目的とします。

## 概要
<!-- TODO: 全体がまとまったらここに概要を箇条書きする -->

## 考えるポイント
- どういうコンポーネントが理想か
  - 理想のコンポーネントの状態を前提に、それを実現するための設計方針を考える
- コンポーネントの粒度
- どのコンポーネントにどの役割を持たせるか
  - ビジネスロジック
  - UI
    - 余白
    - 背景
  - 状態
<!-- TODO: テストしやすい設計か -->
<!-- TODO: Storybook が書きやすいか -->

## 考えないポイント
- コードの細かい書き方
  - 命名規則、型の書き方、etc...
- ディレクトリ構成
- パフォーマンスの観点
  - `React.memo`, `useMemo`, `useCallback` etc...
- 既存のコンポーネントが指針通りになっているか
  - あくまで、これから実装するコンポーネントに関してはこの指針に従って実装しようという姿勢

## どんなコンポーネント設計が理想か
コンポーネントが以下のような状態であることを理想とし、以降ではこの状態を実現するための設計方針を考える。
- 再利用性が高いこと: 他のコンポーネントで再利用しやすい
- 可読性が高いこと: コンポーネントの見通しがよく、理解しやすい
- 独立性が高いこと: 他のコンポーネントに依存せず、独立して動作できる

また、これら3つの状態はお互いに関連している部分も多く、基本的に"単一責任の原則"に従ってコンポーネントを設計し、適切な粒度で分割することで概ね実現できる。
とはいえ、実際には厳密にコンポーネントが1つの責務だけ果たすように実装すると、コンポーネントの数が増えすぎると考えられる。そのため単一とは言わないまでも、理解しやすい粒度で責任を分割し、その粒度事にコンポーネントを実装する。

## コンポーネントの適切な粒度
前述の通り、1つのコンポーネントが持つ責任を理解しやすいようにすることを前提としつつ、React のコンポーネントが持ちうる責任を考えると主に以下のものがある。

- **ビジネスロジック**
  - フォームのバリデーション
  - コンポーネントの disabled or enabled
  - コンポーネントの visible or invisible
  - 画面の制御（どの画面に遷移するか、どのコンポーネントを表示するか、etc...）
- **UI**
  - 色、文字、余白、レイアウト、幅、高さ、etc...
- **DBへのアクセス**
  - query, mutation の実行
    - 結果のハンドリング
    - input の変換

また、Redwood には大きく3種類のコンポーネント(Page, Cell, Component)があり、これらがそれぞれ持つべき責任は以下のようになる。

### Page
Page が持つべき責任は主に以下の通り。
- レイアウト
  - 子コンポーネント同士の余白
  - 画面端からの余白
  - 画面全体の背景色
- 子コンポーネントで共通して参照する状態の管理
- 子コンポーネントの制御
  - state(あるいは route params?)に応じて、表示するコンポーネントを制御する

### Cell
Cell が持つべき責任は主に以下の通り。
- query の実行と、その結果のハンドリング

また、Cell が持つべき責任は基本的に query の実行と、その結果のハンドリングのみであるため、取得した値を参照する範囲だけが Cell 以下のコンポーネントで描く範囲であることが望ましい。
例えば、以下のような画面の場合、

### Component(Page でも Cell でもないコンポーネント)
Component が持つべき責任は主に以下の通り。
- フォームのバリデーション
- コンポーネントの disabled or enabled
- コンポーネントの visible or invisible
- その他静的な要素
- mutation の実行

Page と Cell は比較的責任がわかりやすい一方で、Component は様々な責任を持つことが多いため、いくつか具体例を示す。
<!-- TODO: ここにいくつかの具体例 -->

## 👍 するべきこと

## 👎 しないべきこと
### margin をコンポーネントに持たせるべきではない
コンポーネントが margin を持つと、そのコンポーネントを使う親側では margin があることを知っている必要がある。
これによって子コンポーネントの独立性、再利用性が下がってしまう。

### 再利用しやすいコンポーネントを作るべきだが、不必要な再利用しすぎるべきではない
複数の画面で共通しているコンポーネントを再利用しやすい形で実装することは重要だが、不必要に複数のコンポーネントで再利用することは避けるべきである。
例えば、以下のような
<!-- TODO: ヘッダー、フッターの例 -->
<!-- TODO: Redwood の Wrap を使うことも検討する -->
